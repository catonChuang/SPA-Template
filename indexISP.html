<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>巴黎奧運網路監視</title>
  	<link rel="dns-prefetch" href="//fonts.googleapis.com">
  	<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900&display=swap">
  	<script src="js/jquery.min.js"></script>
	<script src="bootstrapV4/js/bootstrap.min.js"></script>	
	<link href="bootstrapV4/css/bootstrap.min.css" rel="stylesheet">  
	<link rel="stylesheet" href="css/bootstrap-icons/bootstrap-icons.css">	
	<link href="argusApp.css" rel="stylesheet">  
	<script src="js/argus.app.js"></script>
	<script src="xss-filters.min.js"></script>
	<script src="js/d3.v3.min.js" charset="utf-8"></script>
	<script src="js/liquidFillGauge.js" language="JavaScript"></script>

  <style type="text/css">
		
  </style>
</head>
<body>
	<div class="I-Body">
		<div class="row" style="padding-right: 10px;padding-left: 10px;" >
			<div class="col-sm-8">
				<div onclick="goPortal()"><i class="bi bi-chevron-left"></i> <b style="font-size: 20px;">巴黎奧運網路監視</b></div>
			</div>
			<div class="col-sm-4">
				<table class="item-right">
							<tr><td>
							<div id="qrytime" style = "padding-top:5px"><b>呈現時間:</b>&nbsp;<span id="refreshTime">讀取中...</span></div>		
							</td></tr>
					</table>	
			</div>	
		</div>
		<div class="row">
			<div class="col-sm-12">	
				
				<div class="card">	
					<div class="card-header bgBlue">
						<b>ISP</b>
					</div>		
					<div class="card-body" style="padding: 5px;">
						<div class="row" id="mainContent" style="font-size: 14px;" > </div >		
					</div>	
				</div>	
			</div>	
		</div>

		<div class="row  customLabel">
			<div class="col-3" >
				<table width=100%>
					<tr align="center" style="vertical-align: middle; height:60px " class="kindTitle">
					<td>
						<h3 style="padding-top: 8px;"><a href="#" class="badge badge-secondary" style="background: #4070B1;" onclick="goPage('1')">網路<br>拓樸</a></h3>
					</td>
					</tr>
				</table>
			</div>
			<div class="col-3" >
				<table width=100%>
					<tr align="center" style="vertical-align: middle; height:60px " class="kindTitle">
					<td>
						<h3 style="padding-top: 8px;"><a href="#" class="badge badge-secondary" style="background: #4070B1;" onclick="goPage('2')">服務<br>狀態
						</a></h3>
					</td>
					</tr>
				</table>
			</div>
			<div class="col-3" >
				<table width=100%>
					<tr align="center" style="vertical-align: middle; height:60px " class="kindTitle">
							<td>
							<h3 style="padding-top: 8px;"><a href="#" class="badge badge-secondary" style="background: #4070B1;" onclick="goPage('3')">收視<br>指標</a></h3>
							</td>
					</tr>
				</table>
			</div>
			<div class="col-3" >
				<table width=100%>
					<tr align="center" style="vertical-align: middle; height:60px " class="kindTitle">
							<td>
							<h3 style="padding-top: 8px;"><a href="#" class="badge badge-secondary" style="background: #4070B1;" onclick="goPage('4')">ISP<br>互連<br></a></h3>
							</td>
					</tr>
				</table>
			</div>
		</div>
	</div>
</body>
</html>

<script>

	var _jsonSource = "{\"items\":[{\"name\": \"isp\",\"value\": {\"ISP\":[{\"idx\":\"1\",\"cName\":\"新世紀資通(遠傳)\",\"code\":\"hinet-ncic\",\"flow\":\"61527.445\",\"bandwidth\":\"320100\",\"rate\":\"19.22\",\"status\":\"1\"},{\"idx\":\"2\",\"cName\":\"台灣固網(台灣大哥大)\",\"code\":\"hinet-tfn\",\"flow\":\"67307.64\",\"bandwidth\":\"490000\",\"rate\":\"13.74\",\"status\":\"1\"},{\"idx\":\"3\",\"cName\":\"是方電訊\",\"code\":\"hinet-chief\",\"flow\":\"46087.43\",\"bandwidth\":\"600100\",\"rate\":\"7.68\",\"status\":\"1\"},{\"idx\":\"4\",\"cName\":\"台灣智慧光網\",\"code\":\"hinet-taifo\",\"flow\":\"4524.956\",\"bandwidth\":\"21000\",\"rate\":\"21.55\",\"status\":\"1\"},{\"idx\":\"5\",\"cName\":\"中嘉和網\",\"code\":\"hinet-kbt\",\"flow\":\"2544.645\",\"bandwidth\":\"5100\",\"rate\":\"49.9\",\"status\":\"1\"}]},\"sub_tag\": \"curflow\",\"time\": \"2024-07-03 18:25\"}]}" ;

	var refreshSecond = 30;						// 30 秒
	var refreshTime = refreshSecond;			
	var isReLoad = false;
	
	var _empID="";
	var _haveAuth = "false";
	
	var _OBJ = JSON.parse(_jsonSource); 
	

	//==============================
	// 初始呼叫
	//==============================
	$(document).ready(function() {
//				alert(_OBJ.items[0].value.ISP.length);
				
		var _ischange = false; 
		var _theData =_OBJ.items[0].value.ISP;	
								$("#mainContent").html("");	
								_ischange = true;
								if(_theData.length>0){	
									for(var i=0; i <_theData.length ; i++ ){										
										if(i>0){
											if(i%1==0)
												$("#mainContent").append("<br>"); 
										}									
																			
										var _tempHtml = "";
										_tempHtml ="<div class=\"col-sm-6 col-md-4 col-xl-3\">";
										
										var _code = xssFilters.inHTMLData(_theData[i].code);
										var _cName = xssFilters.inHTMLData(_theData[i].cName);
										var _idx = xssFilters.inHTMLData(_theData[i].idx);
										var _flow = xssFilters.inHTMLData(_theData[i].flow);
										var _bandwidth = new Number(xssFilters.inHTMLData(_theData[i].bandwidth));

										_tempHtml +="<table class=\"table table-bordered\" ><tr align=\"center\" ><th class=\"cardTitle\" colspan=\"2\">"+ 
													"<a onclick=\"showInfo('"+_code+"')\">"+_cName+"<i class=\"bi bi-info-circle\"></i></a></th></tr>";  

										_tempHtml +="<tr align=\"center\" ><td colspan=\"2\"><svg id=\"fillgauge"+_idx +"\"  height=\"80px\" width=\"80px\"></svg></td></tr>";									
										var unit ="Mbps";
										var _cur = new Number(_flow);

										if(_cur>1000){
											_cur = _cur/1000
											unit ="Gbps";					
										}
										_cur = _cur.toFixed(3);		
										
										_tempHtml +="<tr align=\"center\"><td width=\"50%\">"+
											"<span class= \"tdLarge\">"+_cur+"<br>"+unit+"</span><br>目前流量"+
											"</td>"+	
											"<td>"+
											"<span class= \"tdLarge\">"+(_bandwidth/1000)+"<br>Gbps</span><br>最高容量"+													
											"</td>"+
											"</tr>";										
																					
										_tempHtml +="</table>";
										_tempHtml +="</div>" ;
									
													
										$("#mainContent").append(_tempHtml);	
									}
									
									drawRate(_theData);

								}
											
				

		refreshTime = 1;	// 設1預設才會run
		changeRefreshTime();
		pageRefresh();
	}); 


	function changeRefreshTime(){
		refreshTime = refreshSecond;
		$('#refreshTime').html(getNowTime());
	}	

	//==============================
	// 更新時間
	//==============================
	function pageRefresh(){
		refreshTime -= 1;	
		if (refreshTime==0){
				refreshContent();
			
		}else{			
		}
		cleartime = setTimeout("pageRefresh()",1000);
	}

	//==============================
	// 更新內容
	//==============================
	function refreshContent(){
		changeRefreshTime();
		// TODO 
		
	}
	
	//		//argus-api/argusProject/getMetric.jsp?projectId=X&category=pm_declaration

		function appGetAuth(){
            var myObj = { "cmd": "getMetric", "value":{"projectId": "333","category":"pm_declaration"}};
           alert( callAppCmd(JSON.stringify(myObj)));
        }
		

		
		//SPA API 教學 https://dev.azure.com/cht-tl-poc/_git/SPA-Template?path=%2Fdocs%2Fos-level-comm-spec.md&_a=preview
	
		function getRestNew(){
		
		//xhr.open("GET", "https://apis-qa.b2e.cht.com.tw/argus-api/argusProject/getMetric.jsp?"+data);
		//xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		//xhr.setRequestHeader("x-api-key", "rQM3IXZkM62lA7E05LMiohRDbCkhiGV4GUvQRpvGIA72J1sw");
		//xhr.setRequestHeader("Authorization", "Bearer "+apim_token);
		//xhr.send();
		//xhr.send(data);
		
			//var myObj = { "cmd": "rest", "value":{"id": "rest1", "restConfig": {"name":"getMetric","relativePath":'/argus-api/argusProject/getMetric.jsp',"method":"GET", "body":{"projectId":"55","category":"pm_declaration"}}}};
			
			
			var myObj = { "cmd": "rest","value":{"id": "restT1","restConfig":{"name":"getMetric","queryParams":{"projectId":"55","category":"pm_declaration"},
			"relativePath":"argusProject/getMetric.jsp","method":"get"}}};
			
			
			//var myObj = { "cmd": "rest", "value":{"id": "rest1", "restConfig": {"name":"apis.spa.qa.ex","method":"GET"}}};
			//var myObj = { "cmd": "rest", "value":{"id": "rest1", "restConfig": {"name":"photo","relativePath":'/831765',"method":"GET"}}};
			var str = callAppCmd(JSON.stringify(myObj));
			//alert(str);

		}
		function callAppCmd (params) {			
			if (window.webkit != undefined) {
				// for iOS
				window.webkit.messageHandlers.callAppCmd.postMessage (params);
				return undefined;
			  } else {
				// for Android
				window.android.callAppCmd(params);
			  }
		 }
		 
		 function appCmdCallback(str){
			alert("appCmdCallback: " + str);
			var obj = JSON.parse(str);
			
			var _theValue = obj.value;
			
			if(obj.cmd=='getInitInfo'){
				_empID =_theValue.userInfo.empID;
				checkAuth();
			}else if(obj.cmd=='rest'){
				if(_theValue.id=='restCheckAuth'){
				
					var _result = _theValue.data;
					_haveAuth =  _result.items[0].value;
					
					if(_haveAuth=="false"){
							$('#messageModel').modal('show');		
					}
				//	alert("_haveAuth"  + _haveAuth +"   " + _result);
				}
			}else{
			
			}		
		}

		function goPortal(){
			var myObj = { "cmd": "goPortal", "value": null};
			var str = callAppCmd(JSON.stringify(myObj));
		}
	
		
		function test1(){
			location.href = 'spaTest.html';
		}
		
		
		
		function checkAuth(){
			var _authCheckStr = "auth_"+_empID;
			var myObj = { "cmd": "rest","value":{"id": "restCheckAuth","restConfig":{"name":"getMetric","queryParams":{"projectId":"0","category":_authCheckStr},"relativePath":"argusProject/getMetric.jsp","method":"get"}}};
			var str = callAppCmd(JSON.stringify(myObj));
		
		}
		
		
		function goPage(pIdx){
			if(pIdx=="1"){
				location.href = 'indexO2024.html';
			}else if(pIdx=="2"){
				location.href = 'indexService.html';
			}else if(pIdx=="3"){
				location.href = 'indexRating.html';
			}else if(pIdx=="4"){
				location.href = 'indexISP.html';
			}
		}
		
		
		function drawRate(_theData){
			for(var i=0 ; i <_theData.length;i++){
					var theRate = _theData[i].rate;
					var config = liquidFillGaugeDefaultSettings();
					config.circleThickness = 0.15;
					var _status = _theData[i].status;

					if(_status!="1"){
						config.circleColor = "red";
						//config.textColor = "#000000";
						config.waveTextColor = "#FFFFFF";
						config.waveColor = "red";
					}else{
						config.circleColor = "#5CB85C";
						//config.textColor = "#000000";
						config.waveTextColor = "#FFFFFF";
						config.waveColor = "#5CB85C";
					}

					config.textVertPosition = 0.55;
					config.waveAnimateTime = 1000;
					config.waveHeight = 0.05;
					config.waveAnimate = true;
					config.waveRise = false;
					config.waveHeightScaling = false;
					config.waveOffset = 0.25;
					config.textSize = 0.9;
					config.waveCount = 3;
		
				loadLiquidFillGauge("fillgauge"+_theData[i].idx, theRate,config);
			}
	}
		

	</script>
	
 <div class="modal hide fade" data-keyboard="false" data-backdrop="static" id="messageModel" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">    	     
        <div class="modal-body">
			很抱歉您沒有權限，請於電子表單申請帳號-IS32進行權限申請， 系統請選Argus->申請ARGUS帳號
        </div> 
		<div class="modal-footer">
           <button type="button" class="btn btn-success" onclick="goPortal()">確定</button>
        </div>		
      </div>
    </div>
  </div>